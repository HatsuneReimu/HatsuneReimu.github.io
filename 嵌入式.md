# 嵌入式

## 作业：

### 一次： 

**1、比较 MCU 与 CPU 的异同，及其相互之间的联系？**
答：CPU(central Processing Unit)：中央处理器。是计算机系统的运算和控制核心，是信息处理、程序运行的最终执行单元。
MCU:MCU(Micro Control Unit)：微控制单元。在一块芯片内集成了中央处理单元、存储器（RAM/ROM等）、定时器/计数器及多种输入输出（I/O）接口的比较完整的数字处理系统。
区别：CPU是数据处理的单元，MCU中一般包含CPU，但除了数据处理单元外还有其他的外围的模块，如、RAM、ROM、定时计数器和多种I/O接口等，也就是说，MCU是集成了CPU和其他外围模块的微型控制单元。
关系：MCU是在CPU的频率与规格做适当缩减，并添加上内存等形成芯片级计算机。

**2、嵌入式开发时，主函数中使用的无限循环起什么作用？**
答：由于程序都是顺序执行旳。 如果不使用无限循环,程序执行一遍代码,就不能在接受其她旳任务操作了。  但是使用了无限循环,就可以不断地监听任务,并执行。

### 二次：

**1、关键字 volatile 在编程开发中所起的作用？**
答：确保对变量的访问是直接从系统内存中读取的，而不是从 CPU 缓存中读取的。 volatile的作用是作为指令关键字，确保本条指令不会因编译器的优化而省略，且要求每次直接读值。如果没有volatile关键字，则编译器可能优化读取和存储，可能暂时使用寄存器中的值，如果这个变量由别的程序更新了的话，将出现不一致的现象。

**2、什么是芯片的硬件最小系统，它由哪几部分组成？简要阐述各部分技术要点。**
答：单片机最小系统主要由晶振、电源、复位电路和写入调试器接口组成。其中，晶振是最小系统的核心部分，它提供了单片机的时钟信号。晶振一般由晶体振荡器和电容组成，晶体振荡器是晶振的发生器，电容则是晶振的稳定器。电源为单片机提供电能，保证其正常工作。电源一般由电池、稳压电源、变压器等组成。复位电路则保证单片机在复位时能够正常工作。复位电路一般由复位电路芯片和电容组成。SWD引脚接口是在芯片内部没有程序的情况下，需要用写入器将程序写入芯片，串行线调试接口SWD是一种写入方式的接口。

### 三次：

**1、让 PTA.2 输出“0”（高电平），需要进行哪些配置？**



**2、什么叫上拉电阻？它的作用是什么？如何选择上拉电阻的阻值？在哪些情况下使用上拉电阻?**

 若MCU的某个引脚通过一个电阻接到电源上，这个电阻就被称为上拉电阻

使得悬空的芯片引脚被上拉电阻初始化为高电平

上拉电阻阻值的选择原则包括:

1. 从节约功耗及芯片的灌电流能力考虑应当足够大；电阻大，电流小。
2. 从确保足够的驱动电流考虑应当足够小；电阻小，电流大。
3. 对于高速电路，过大的上拉电阻可能边沿变平缓。

综合考虑以上三点,通常在1k到10k之间选取。对下拉电阻也有类似道理。

### 四次：

**1、STM32 中的 MOV 指令与 LDR 指令的区别和用途？**

LDR指令用于从内存中读取数据到寄存器中，而MOV指令用于将数据从一个寄存器复制到另一个寄存器中

### 五次：

**1、 实现计数与定时的基本方法有哪几种？比较它们的优缺点。**

实现计数与定时的基本方法有三种:完全硬件方式、完全软件方式和可编程计数器/定时器方法。 其中完全硬件方式基于逻辑电路实现，它的速度快,但通用性和灵活性差;完全软件方式是利用计算机执行指令的时间实现定时，它的优点是节省硬件。 主要缺点是执行延时程序期间,CPU一直被占用,所以降低了CPU的使用效率,也不容易提供多作业环境;可编程计数器/定时器方法根据需要的时间，用指令对定时器进行初始常数设定，并用指令启动定时器开始计数，它的最突出的优点是计数时不占用CPU的时间。

### 六次：

**1、简述 SPI 的收发数据的工作过程**

 SPI使用四根线进行通信：SCK（Serial Clock）、MOSI（Master Out Slave In）、MISO（Master In Slave Out）和SS（Slave Select）。SCK线用于同步所有设备的数据传输，MOSI和MISO线用于在主设备和从设备之间传输数据，SS线用于选择激活某个从设备。

移位寄存器为8位，所以每个工作过程传送8位数据。从主机CPU发出启动传输信号开始。将要传送的数据装人8位移位寄存器,并同时产生8个时钟信号依次队SCK引脚送出，在SCK信号的控制下，主机中8位移位寄存器中的数据依次从MOSI引脚送出至从机的MOSI引脚，并送入从机的8位移位寄存器。在此过程中.从机的数据也可通 过MISO引脚传送到主机中。所以，该过程称为全双工主从连接,其数据的传输格式是高位(MSB)在前，低位(LSB)在后。

## 嵌入式系统过程性考核

### 考核一 

**1、简要论述可屏蔽中断和不可屏蔽中断的基本含义并举例说明。**

 根据中断是否可以通过程序设置的方式被屏蔽，可将中断划分为可屏蔽中断和不可屏蔽中断两种。可屏蔽中断是指可以通过程序设置的方式来决定不响应该中断，即该中断被屏蔽;不可屏蔽中断是指不能通过程序方式关闭的中断。
典型的非屏蔽中断源的例子是电源掉电，一旦出现，必须立即无条件地响应，否则进行其他任何工作都是没有意义的。典型的可屏蔽中断源的例子是打印机中断，CPU对打印机中断请求的响应可以快一些，也可以慢一些，因为让打印机等待儿是完全可以的。

**2、简述波特率的概念。设波特率为 9600，使用 NRZ 格式的 8 个数据位、没有校验位、1 个开始位、1 个停止位，传输 2K 字节的文件最少需要多少时间?**

波特率表示单位时间内传送的 码元 符号的个数，它是对符号传输速率的一种度量.

9600就一秒钟发送9600bit 那么2k的数据 = 2048bit NRZ格式是8个数据位 1 个开始位1个停止位 那么对于一个基本的NRZ数据帧2k数据就要被分成 2048 ÷ 8 = 256个数据帧中的有效数据 那么 既然有256个数据帧 每一帧数据共有 256 ×(8 + 1+1) = 2560个bit
总数据量是2304 每秒能发 9600 用2560 ÷ 9600 = 0.267秒

**3、简述 printf 函数在嵌入式开发中一般用于什么方面？及在嵌入式开发中的作用有哪些？使用 printf 函数之前的设置流程？**

在使用printf函数之前，需要先进行相应的设置,将其与希望使用的串口模块关联起来，设置步骤如下。

(1)在printf函数的头文件printf.h中宏定义需要与printf函数相关联的调试串口号，例如:

```c
#define UART_printf UART_3                            //printf函数使用的串口号
```

(2)在使用printf函数前，调用UART驱动构件中的初始化丽数对使用的调试串口进行初始化，配置其波特率。例如:

```c
uart_ init(UART_printf, 115200);                           //初始化调试串口
```

这样就将相应的串口模块与print函数关联起来了。由于BIOS已经对其初始化，因 此User中可以不再重新初始化。关于printf函数的使用方法,参见printf. h文件的尾部，

### 考核二 

**1、请简要说明输入捕捉和输出比较的基本含义与应用场合。**

输入捕捉的基本含义与应用场合

输入捕捉是用来监测外部开关量输入信号变化的时刻。当外部信号在指定的MCU输入捕捉引脚上发生一个沿跳变(上升沿或下降沿)时,定时器捕提到沿跳变后，把计数器当前值锁存到通道寄存器，同时产生输人捕捉中断.利用中断处理程序可以得到沿跳变的时刻，这个时刻是定时器工作基础上的更精细时刻。

输入捕捉的应用场合主要有测量脉冲信号的周期与波形。例如，自己编程产生的PWM波，可以直接连接输人捕捉引脚，通过输人捕捉的方法测量回来，确定是否达到要求，输人捕捉的应用场合还有电机的速度测量。

输出比较的基本含义与应用场合

输出比较的功能是用程序的方法在规定的较精确时刻输出需要的电平，实现对外部电路的控制。MCU输出比较模块的基本工作原理是:当定时器的某通道用作输出比较功 能时，通道寄存器的值和计数寄存器的值每隔4个总线周期比较-次。 当两个值相等时，输出比较模块将定时器捕捉/比较寄存器的中断标志位置为1.并且在该通道的引脚上输出预先规定的电平。如果允许输出比较中断.则还会产生一个中断。

输出比较的应用场合主要有产生一定间隔的脉冲，典型的应用实例就是实现软件的串行通信。用输人捕捉作为数据输人，而用输出比较作为数据输出。根据通信的波特率向通道寄存器写人延时的值，该待传的数据位可确定有效输出电平的高低。在输出比较中断处理程序中,重新更改通道寄存器的值,并根据下一位数据改写有效输出电平的控制位。

**2、DMA 的基本含义是什么？DMA 一般用于哪些情况下？请给出DMA 的具体操作流程？**

DMA可以直接访问STM32内部的存储器，DMA是一种技术，允许外设和存储器之间直接传输数据，而无需通过CPU进行数据搬运。这种技术大大提高了数据传输效率，减少了CPU的负担，使CPU能够专注于其他计算任务。

DMA可以提供外设（外设寄存器，⼀般是外设的数据寄存器DR（Data Register），比如ADC的数据寄存器，串口的数据寄存器）和存储器（运行内存（SRAM）和程序存储器（Flash）是存储变量数组和程序代码的地方）或者存储器与存储器之间的高速数据传输，非常适合用于需要高带宽数据流的应用，例如音频数据传输、图像处理等。

这里以RAM与1/O接口之间通过DMA的数据传输为例来说明一一个完整的DMA传输过程，一般需经过请求一响应一传输结束4个步骤。

(1) CPU向DMA发出请求。CPU完成对DMA控制器的初始化，并且向I/O接口发出操作命令I/O接口向DMA控制器提出请求。

(2)DMA响应。DMA控制器对DMA请求判别优先级及屏蔽，向总线裁决逻辑提出总线请求。当CPU执行完当前总线周期即可释放总线控制权。此时，总线裁决逻辑输出总线应答,表示DMA已经响应，通过DMA控制器通知I/O接口开始DMA传输。

(3) DMA传输。DMA控制器获得总线控制权后,CPU即刻挂起或只执行内部操作，由DMA控制器输出读写命令,直接控制RAM与I/0接口进行DMA传输。

(4)DMA结束。当完成规定的成批数据传送后,DMA控制器即释放总线控制权,并向I/O接口发出结束信号。当I/O接口收到结束信号后，一方面停止I/O设备的工作，另一方面向CPU发出中断请求,使CPU从不介入的状态中解脱，并执行段检查本次DMA传输操作正确性的代码。最后，带着本次操作结果及状态继续执行原来的程序。

由此可见.DMA传输方式无须CPU直接控制传输，也没有中断处理方式那样保留现 场和恢复现场的过程，通过硬件为RAM与1/O设备开辟一条直接传送 数据的通路，使CPU的效率大为提高。

**3、STM32L431RCTX 芯片复位到 main 函数之前，程序运行的过程？**

由于在链接文件STM32L431RCTX. FLASH. Id中,链接时将__StackTop 的值放到 Flash的0x0800_D000地址中，芯片上电复位后，芯片内部机制首先从Flash的0x0800_D000地址中取出第1个表项的内容，赋给内核寄存器SP(堆栈指针)，完成堆栈指针初始化。

芯片内部机制将第2个表项的内容，赋值给内核寄存器PC(程序计数器)。由于该表项存放启动函数Reset_Handler的首地址，因而运行..\03_MCU\startup\startup_ stm32l433rctxp. s文件中的Reset Handler函数,第1个语句就是“LDR SP, =_estack",SP的值又被赋值一次。接着进行初始化数据处理及清零未初始化BSS数据段，运行..\03 MCU\startup\ system _stm32l4xx.c 文件中的SystemInit函数,进行芯片部分初始化设置 (依次关闭看门狗、系统时钟初始化)，再回到Reset Handler中继续剩余初始化功能，随后进入用户主函数main。一般情况下,认为程序从main函数开始运行。


### 考核三

**1、简要论述系统窗口看门狗和独立看门狗的基本含义、应用背景和触发流程。**

看门狗定时器( Watchdog Timer)具有监视系统功能，当运行程序跑飞或一个系统中的关键系统时钟停止引起严重后果的情形下，看门狗会通过复位系统的方式，将系统带到一个安全操作的状态。正常情况下，看门狗通过与软件的定期通信来监视系统的执行过程，看门狗定时器清零,即定期喂看门狗。如果应用程序丢失，未能在看门狗计数器超时之前清零，则将产生看门狗复位，强制将系统恢复到一个已知的起点。

STM32L431芯片含有两种看门狗:系统窗口看门狗WWDG)和独立看门狗(IWDG)。两种看门狗的主要区别在于:系统窗口看门狗需要在指定的计数范围内“喂狗”，否则会触发系统复位，且可使用提前唤醒中断(EWI);而独立看门狗只需要在计数值到0前复位即可，不需要在指定的窗口范围内“喂狗”。

系统窗口看门狗(WWDG)通常被用来监测由外部干扰或不可预见的逻辑判断造成的应用程序偏离正常运行面产生的软件故障。当程序没有在递减寄存器的T[6:0]位变为0前刷新递减计数器的值则看门狗电路在达到预置的时间周期时，会产生一个MCU复位。如果在递减计数器达到窗口寄存器值之前刷新控制寄存器中的7位递减计数器值，也会产生MCU复位。这意味着必须在限定的时间窗口内刷新计数器。

独立看门狗能够检测并解决软件错误引起的系统失灵问题，当计数溢出时会触发系统复位。 独立看门狗的时钟由其专用的32kHz低速内部时钟(LSI)提供，只要在向下计数器计数到0之前重载计数值就能能组织独立看门狗复位。

**2、什么是脉宽调制输出? 主要用途是什么?**

脉宽调制（Pulse-Width Modulation，PWM）是利用微处理器的数字输出，来对模拟电路进行控制的一种非常有效的技术，通过对一系列脉冲的宽度进行调制，来等效的获得所需要的波形（含形状和幅值），即通过改变导通时间占总时间的比例，也就是占空比，达到调整电压和频率的目的。

## 大作业

**一、名词解释**

ROM；SPI；GPIO；PWM；USB；LED；LCD；CPU；ADC；CISC； UART； MCU；SoC；MAP；RTOS； GEC；SCI； ISPR；EEPROM；I2C

**二、问答题**

1、与通用计算机相比，嵌入式系统有哪些特点？

答：
专用性：嵌入式系统是为特定的应用而设计的，不强调通用性和可扩展性，而是注重满足用户的特定需求。
实时性：嵌入式系统通常需要在规定的时间内完成任务，对响应速度和可靠性有较高的要求。
可裁剪性：嵌入式系统可以根据应用的不同，灵活裁剪软硬件，以达到最优的性能和成本的平衡。
小型化：嵌入式系统的体积和重量通常比较小，方便嵌入到目标设备中，也有利于节省空间和资源。
低功耗：嵌入式系统的功耗通常比较低，以延长电池寿命和降低散热问题。
高可靠性：嵌入式系统的可靠性通常比较高，因为它们可能工作在恶劣的环境中，或者涉及到人身安全和国家利益等重要事务。

2、底层驱动构件在嵌入式开发中占据重要地位，站在嵌入式开发者的角度简要描述构件设计的基本原则。

答：

3、要论述为什么需要设计 GPIO 驱动构件？

答：利用软件构件，编程开发效率且程序更规范；将底层驱动封装成构件，可提高复用性，能更多关注软件优化与稳定性。可移植性、可复用性、方便不同构件间交流

4、实现计数与定时的基本方法有哪几种？比较它们的优缺点。

答：实现计数与定时的基本方法有三种:完全硬件方式、完全软件方式和可编程计数器/定时器方法。 其中完全硬件方式基于逻辑电路实现，它的速度快,但通用性和灵活性差;完全软件方式是利用计算机执行指令的时间实现定时，它的优点是节省硬件。 主要缺点是执行延时程序期间,CPU一直被占用,所以降低了CPU的使用效率,也不容易提供多作业环境;可编程计数器/定时器方法根据需要的时间，用指令对定时器进行初始常数设定，并用指令启动定时器开始计数，它的最突出的优点是计数时不占用CPU的时间。

5、简述 SPI 的收发数据的工作过程。

答：移位寄存器为8位，所以每个工作过程传送8位数据。从主机CPU发出启动传输信号开始。将要传送的数据装人8位移位寄存器,并同时产生8个时钟信号依次队SCK引脚送出，在SCK信号的控制下，主机中8位移位寄存器中的数据依次从MOSI引脚送出至从机的MOSI引脚，并送入从机的8位移位寄存器。在此过程中.从机的数据也可通 过MISO引脚传送到主机中。所以，该过程称为全双工主从连接,其数据的传输格式是高位(MSB)在前，低位(LSB)在后。

6、描述一下位带操作的基本含义？并结合书中的例子，简要总结一下位带操作功能的优势。

答：只对字中某位的操作需要位带操作的支持，位带操作实质上是一种内存映射关系，芯片内部机制将位带区的存储单元按位映射到对应的别名区的32位字上，别名区中的一个32位地址，对应位带区一个地址中的一个位。按字访问别名区的存储单元时，就相当于访问位带区对应的位，即通过对别名区地址的访问等同于对真实地址的某个位的访问。

**三、综合题**

1、画出 I2C 构件中的主机向从机读写 1 字节数据的过程示意图，并对该读写 1 字节的过程进行详细描述

![image-20240623212921789](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240623212921789.png)

![image-20240623203809207](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240623203809207.png)

![image-20240623212944703](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240623212944703.png)

![image-20240623203821372](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240623203821372.png)

2、设一个系统需 2 路串行通信，需采集 2 路温度、3 路压力、3 个开关量；需控制 2 个开关量，2 路 PWM 输出。请给出硬件框图、软件架构、底层构件列表等基本设计要素。



![image-20240623165159048](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20240623165159048.png)

4、M4 指令系统寻址方式有几种？简要描述各自特点，并指出下列指令的寻址方式。

立即数寻址
操作数直接通过指令给出。用“#”作为立即数的前导标识符。M4微处理器的立即数范围是0x00~-0xFF。例如：
	MOV 	R0, # 0xFF 		//立即数0xFF装入R0寄存器
	SUB	   R1, R0, # 1		//R1←R0 - 1

寄存器寻址
操作数来自寄存器。例如：
	MOV 	R0, R1				//将R1寄存器内容装入R0寄存器

直接寻址
操作数来自存储单元，指令中直接给出存储单元地址。指令码中显示给出数据的位数，如：字、半字、单字节。例如：
	LDR 	Rt, label				//从标号label处连续读取4字节到寄存器中
	LDRH 	Rt, label				//从地址label处读取半字到Rt中
	LDRB 	Rt, label				//从地址label处读取字节到Rt中

偏移寻址及寄存器间接寻址
偏移寻址的操作数来自存储单元，指令中通过寄存器及偏移量给出存储单元的地址。偏移量不超过4KB。偏移量为0的偏移寻址也成为寄存器间接寻址。例如：
        LDR 	R3, [PC, # 100]			//从地址（PC+100）处读取4字节到R3中
	LDR 	R3, [R4]				//以R4中内容为地址，读取4字节到R3中

5、阐述 PWM 信号的技术指标，并详细写出 PWM 构件初始化函数的模型（包括详细说明每个输入参数的实际意义）。

答：PWM信号的主要主要技术指标有周期、占空比、极性、脉冲宽度、分辨率、对齐方式等。

```c
void pwm_init(uint16_t pwmNo,uint32_t clockFre,uint16_t period,double duty,uint8_t align,uint8_t pol);

pwmNo:pwm通道号（使用宏定义PWM_PINO,PWM_PIN1...）
clockFre:时钟频率
period:周期。单位为个数，即计数器跳动次数，1-65536
duty:占空比
align:对齐方式，在头文件宏定义给出，入PWM_EDGE为边沿对齐
pol:极性，在头文件宏定义给出，如PWM_PLUS为正极性
```

